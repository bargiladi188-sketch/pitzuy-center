<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×‘×“×™×§×ª ×–×›××•×ª ×œ×¤×™×¦×•×™ â€“ ×ª××•× ×ª ×¢×‘×•×“×”</title>

  <style>
    :root{
      --bg1:#f7f9ff;
      --bg2:#eef5ff;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e5e7eb;
      --primary:#1e40af;
      --primary2:#2563eb;
      --accent:#06b6d4;
      --success:#16a34a;
      --danger:#dc2626;

      --shadow: 0 18px 45px rgba(15,23,42,.08);
      --shadow2: 0 10px 25px rgba(15,23,42,.08);
      --radius: 20px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(900px 450px at 85% 0%, #dbeafe 0%, transparent 55%),
                  radial-gradient(900px 450px at 15% 10%, #cffafe 0%, transparent 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      line-height: 1.65;
    }

    .wrap{ max-width: 860px; margin: 0 auto; padding: 42px 18px 80px; }
    .shell{
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(226,232,240,.7);
      border-radius: 28px;
      padding: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 16px;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 26px;
      box-shadow: var(--shadow2);
    }

    .brand{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 10px 6px 20px;
    }
    .logo{
      display:flex; align-items:center; gap:10px;
      font-weight: 900;
      color: var(--primary);
      letter-spacing: .2px;
    }
    .mark{
      width: 34px; height: 34px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      box-shadow: 0 10px 20px rgba(37,99,235,.25);
    }
    .metaTop{
      font-size: 12px; color: var(--muted);
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(203,213,225,.8);
      background: rgba(255,255,255,.7);
    }
    .dot{ width:8px; height:8px; border-radius:50%; background: var(--success); }

    h1{
      margin: 0 0 10px;
      font-size: 34px;
      line-height: 1.2;
      letter-spacing: -.3px;
    }
    .lead{
      margin: 0 0 16px;
      color: var(--muted);
      font-size: 17px;
    }

    .heroCTA{
      display:flex; gap:12px; flex-wrap:wrap; align-items:center;
      margin-top: 14px;
    }
    .btn{
      border:0;
      border-radius: 14px;
      padding: 14px 18px;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      color:#fff;
      font-weight: 900;
      font-size: 16px;
      cursor:pointer;
      box-shadow: 0 16px 30px rgba(37,99,235,.22);
      transition: transform .15s ease, filter .15s ease;
      min-width: 240px;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.02); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }

    .btnGhost{
      border-radius: 14px;
      padding: 14px 18px;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(203,213,225,.9);
      color: var(--text);
      font-weight: 800;
      cursor:pointer;
      min-width: 240px;
    }

    .trustRow{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 18px;
    }
    @media (max-width: 860px){
      .trustRow{ grid-template-columns: 1fr; }
    }
    .trust{
      border: 1px solid rgba(226,232,240,.9);
      border-radius: 16px;
      padding: 14px;
      background: linear-gradient(180deg, #ffffff, #fbfdff);
    }
    .trust b{ display:block; margin-bottom: 4px; }
    .trust span{ color: var(--muted); font-size: 13px; }

    .sideCard h2{
      margin: 0 0 10px;
      font-size: 16px;
      color: var(--primary);
      letter-spacing: .2px;
    }
    .steps{
      margin: 0; padding: 0; list-style:none;
      display:flex; flex-direction:column; gap:10px;
    }
    .step{
      display:flex; gap:10px; align-items:flex-start;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(226,232,240,.9);
      background: #fff;
    }
    .num{
      width: 28px; height: 28px; border-radius: 10px;
      background: rgba(37,99,235,.10);
      color: var(--primary);
      font-weight: 900;
      display:flex; align-items:center; justify-content:center;
      flex: 0 0 auto;
    }
    .step p{ margin:0; color: var(--muted); font-size: 14px; }
    .note{ margin-top: 10px; color: var(--muted); font-size: 12px; }

    /* QUIZ */
    .hidden{ display:none !important; }
    .quizTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      border: 1px solid rgba(203,213,225,.9);
      background: rgba(255,255,255,.75);
      color: var(--text);
    }
    .badgeGold{ background:#fff7ed; border-color:#fed7aa; color:#9a3412; }
    .badgeHigh{ background:#f0f9ff; border-color:#bae6fd; color:#075985; }
    .badgeMed{ background:#f5f3ff; border-color:#ddd6fe; color:#5b21b6; }
    .badgeLow{ background:#f8fafc; border-color:#e2e8f0; color:#334155; }

    .progressWrap{
      width: 100%;
      margin: 10px 0 16px;
    }
    .progressText{ font-size: 13px; color: var(--muted); font-weight: 700; }
    .bar{
      height: 10px;
      background: rgba(226,232,240,.9);
      border-radius: 999px;
      overflow:hidden;
      margin-top: 8px;
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transition: width .25s ease;
    }

    .qTitle{
      margin: 0 0 8px;
      font-size: 20px;
      letter-spacing: -.1px;
    }
    .hint{ color: var(--muted); font-size: 13px; font-weight: 650; margin-bottom: 8px; }

    .option{
      display:flex;
      align-items:flex-start;
      gap: 12px;
      padding: 14px;
      margin: 10px 0;
      border-radius: 16px;
      border: 1px solid rgba(203,213,225,.9);
      background: rgba(255,255,255,.9);
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .option:hover{
      transform: translateY(-1px);
      border-color: rgba(37,99,235,.35);
      background: #f8fbff;
    }
    .option input{ width: 18px; height: 18px; margin-top: 2px; cursor:pointer; }
    .option label{ cursor:pointer; font-weight: 700; flex: 1; }

    .actions{
      display:flex; gap:12px; flex-wrap:wrap;
      margin-top: 12px;
    }
    .actions button{ flex: 1 1 200px; }

    .divider{
      height:1px;
      background: rgba(226,232,240,.9);
      margin: 18px 0;
    }
    .err{
      display:none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: var(--danger);
      font-weight: 800;
      font-size: 13px;
    }
    .ok{
      display:none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: var(--success);
      font-weight: 900;
      font-size: 13px;
    }

    /* CONTACT */
    .field label{ display:block; font-weight: 800; margin: 10px 0 6px; }
    input[type="text"], input[type="tel"], select{
      width:100%;
      padding: 14px;
      border-radius: 14px;
      border: 1px solid rgba(203,213,225,.9);
      background: rgba(255,255,255,.95);
      font-size: 16px;
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    input:focus, select:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 0 0 4px rgba(37,99,235,.12);
    }
    .tiny{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">

      <div class="brand">
        <div class="logo">
          <div class="mark" aria-hidden="true"></div>
          <div>×‘×“×™×§×ª ×–×›×•×™×•×ª â€“ ×ª××•× ×ª ×¢×‘×•×“×”</div>
        </div>
        <div class="metaTop">
          <span class="pill"><span class="dot"></span> ×œ×œ× ×”×ª×—×™×™×‘×•×ª</span>
          <span class="pill">â± ~2 ×“×§×•×ª</span>
          <span class="pill">ğŸ”’ ×“×™×¡×§×¨×˜×™</span>
        </div>
      </div>

      <!-- LANDING -->
      <div id="landing" class="grid">
        <div class="card">
          <h1>× ×¤×’×¢×ª ×‘×¢×‘×•×“×”? ×‘×•×/×™ × ×¢×©×” ×¡×“×¨.</h1>
          <p class="lead">
            ×‘×“×™×§×” ×§×¦×¨×” ×©×ª×¢×–×•×¨ ×œ×”×‘×™×Ÿ ×× ×™×™×ª×›×Ÿ ×©××’×™×¢ ×œ×š ×¤×™×¦×•×™ â€” ×’× ×× ××ª/×” ×œ× ×‘×˜×•×—/×” ×©×–×” â€œ× ×—×©×‘â€.
          </p>

          <div class="heroCTA">
            <button class="btn" id="startBtn">×”×ª×—×œ/×™ ×‘×“×™×§×” ×§×¦×¨×”</button>
            <button class="btnGhost" id="scrollMoreBtn" type="button">××” ×”×•×œ×š ×œ×§×¨×•×ª ×¤×”?</button>
          </div>

          <div class="trustRow" id="moreArea">
            <div class="trust">
              <b>×©×§×˜ ×•×‘×˜×•×—</b>
              <span>×”×©××œ×•×Ÿ × ×•×¢×“ ×œ×¢×©×•×ª ×¡×“×¨ â€” ×‘×œ×™ ×œ×—×¥ ×•×‘×œ×™ ×”×ª×—×™×™×‘×•×ª.</span>
            </div>
            <div class="trust">
              <b>×××•×§×“ ×‘××™×›×•×ª</b>
              <span>×›××” ×©××œ×•×ª ×§×¦×¨×•×ª ×›×“×™ ×œ×”×‘×™×Ÿ ××ª ×”×ª××•× ×”, ×‘×œ×™ ×—×§×™×¨×”.</span>
            </div>
            <div class="trust">
              <b>×¦×¢×“ ×”×‘× ×‘×¨×•×¨</b>
              <span>×× ×ª×¨×¦×™ â€” ×’×•×¨× ×× ×•×¡×” ×™×—×–×•×¨ ××œ×™×™×š ×•×™×“×‘×¨ ××™×ª×š ×‘×’×•×‘×” ×”×¢×™× ×™×™×.</span>
            </div>
          </div>

          <p class="note">
            *×”××™×“×¢ × ×•×¢×“ ×œ×”×›×•×•× ×” ×¨××©×•× ×™×ª ×‘×œ×‘×“ ×•××™× ×• ×™×™×¢×•×¥ ××©×¤×˜×™.
          </p>
        </div>

        <div class="card sideCard">
          <h2>××™×š ×–×” ×¢×•×‘×“</h2>
          <ul class="steps">
            <li class="step"><div class="num">1</div><p>×¢× ×™ ×¢×œ ×›××” ×©××œ×•×ª ×§×¦×¨×•×ª (×‘×¢×¨×š 2 ×“×§×•×ª).</p></li>
            <li class="step"><div class="num">2</div><p>×× ×—× ×• ××‘×™× ×™× ×˜×¨×™×•×ª, ×”×©×¤×¢×” ×•×ª×™×¢×•×“ â€” ×›×“×™ ×œ× ×œ×‘×–×‘×– ×œ×š ×–××Ÿ.</p></li>
            <li class="step"><div class="num">3</div><p>×‘×¡×•×£, ×× ×ª×¨×¦×™, ×ª×©××™×¨×™ ×¤×¨×˜×™× ×œ×©×™×—×” ×©×¢×•×©×” ×¡×“×¨.</p></li>
          </ul>
          <div class="divider"></div>
          <div class="note">
            ×˜×™×¤: ×× ×™×© ×ª×™×¢×•×“ ×¨×¤×•××™ ××• ×“×™×•×•×— ×œ××¢×¡×™×§ â€” ×–×” ×¢×•×–×¨ ×××•×“.
          </div>
        </div>
      </div>

      <!-- QUIZ -->
      <div id="quiz" class="card hidden">
        <div class="quizTop">
          <span id="leadBadge" class="badge badgeLow">×‘×“×™×§×”</span>
          <span id="progressTxt" class="progressText">×©××œ×” 1 ××ª×•×š 6</span>
        </div>

        <div class="progressWrap">
          <div class="bar"><div id="progressFill" class="fill"></div></div>
        </div>

        <h2 id="qTitle" class="qTitle"></h2>
        <div id="qHint" class="hint"></div>
        <form id="qForm"></form>

        <div class="actions">
          <button class="btnGhost" id="backBtn" type="button">××—×•×¨×”</button>
          <button class="btn" id="nextBtn" type="button">×”××©×š</button>
        </div>
        <div id="errBox" class="err"></div>
      </div>

      <!-- CONTACT -->
      <div id="done" class="card hidden">
        <h2>×¡×™×™×× ×• âœ…</h2>
        <p class="lead">
          ×¢×‘×¨× ×• ×™×—×“ ×¢×œ ×›××” ×©××œ×•×ª ×›×“×™ ×œ×”×‘×™×Ÿ ××ª ×”××¦×‘ ×©×œ×š.
          ×× ×ª×¨×¦×™/×”, ×’×•×¨× ×× ×•×¡×” ×‘×ª×—×•× ×ª××•× ×•×ª ×¢×‘×•×“×” ×™×•×›×œ ×œ×—×–×•×¨ ××œ×™×™×š, ×œ×”×¡×‘×™×¨ ×–×›×•×™×•×ª ×•××” ×”×¦×¢×“ ×”× ×›×•×Ÿ ×”×‘× â€” ×‘×œ×™ ×”×ª×—×™×™×‘×•×ª.
        </p>

        <div class="divider"></div>

        <div class="field">
          <label for="fullName">×©× ××œ×</label>
          <input type="text" id="fullName" placeholder="×œ×“×•×’××”: ×‘×¨ ×›×”×Ÿ" />
        </div>

        <div class="field">
          <label for="phone">×˜×œ×¤×•×Ÿ</label>
          <input type="tel" id="phone" placeholder="05X-XXXXXXX" />
        </div>

        <div class="field">
          <label for="prefTime">××ª×™ ×”×›×™ × ×•×— ×œ×“×‘×¨? (××•×¤×¦×™×•× ×œ×™)</label>
          <select id="prefTime">
            <option value="">×œ×‘×—×™×¨×”</option>
            <option>×‘×•×§×¨</option>
            <option>×¦×”×¨×™×™×</option>
            <option>××—×¨ ×”×¦×”×¨×™×™×</option>
            <option>×¢×¨×‘</option>
          </select>
        </div>

        <p class="tiny">
          ×‘×œ×—×™×¦×” ×¢×œ ×”×›×¤×ª×•×¨, ×”×¤×¨×˜×™× ×•×”×‘×“×™×§×” ×™×™×©×œ×—×• ×œ××¢×¨×›×ª ×©×œ×š (Make Webhook).
        </p>

        <button class="btn" id="submitBtn">×¨×•×¦×” ×©×™×—×–×¨×• ××œ×™×™ ×•×™×¢×©×• ×œ×™ ×¡×“×¨</button>
        <div id="submitErr" class="err"></div>
        <div id="submitOk" class="ok"></div>

        <div class="divider"></div>
        <button class="btnGhost" id="restartBtn" type="button">××™×œ×•×™ ××—×“×©</button>
      </div>

    </div>
  </div>

<script>
  // =========================
  // ×”×“×‘×™×§×™ ×›××Ÿ ××ª ×”-Webhook ×©×œ Make
  // =========================
  const WEBHOOK_URL = "PASTE_YOUR_WEBHOOK_URL_HERE";

  const landingEl = document.getElementById("landing");
  const quizEl = document.getElementById("quiz");
  const doneEl = document.getElementById("done");

  const startBtn = document.getElementById("startBtn");
  const scrollMoreBtn = document.getElementById("scrollMoreBtn");
  const moreArea = document.getElementById("moreArea");

  const backBtn = document.getElementById("backBtn");
  const nextBtn = document.getElementById("nextBtn");

  const qTitle = document.getElementById("qTitle");
  const qHint  = document.getElementById("qHint");
  const qForm  = document.getElementById("qForm");

  const errBox = document.getElementById("errBox");

  const progressTxt = document.getElementById("progressTxt");
  const progressFill = document.getElementById("progressFill");
  const leadBadge = document.getElementById("leadBadge");

  const submitBtn = document.getElementById("submitBtn");
  const restartBtn = document.getElementById("restartBtn");
  const submitErr = document.getElementById("submitErr");
  const submitOk  = document.getElementById("submitOk");

  const state = {
    step: 0,
    answers: {
      q1_whenContext: null,
      q2_whenTime: null,
      q3_impact: null,
      q4_docs: [],
      q5_process: null
    }
  };

  const steps = [
    {
      id: "q1",
      title: "××ª×™ ×–×” ×§×¨×”? (×”×× ×”×¤×’×™×¢×” ×”×ª×¨×—×©×” ×‘×–××Ÿ ×”×¢×‘×•×“×”, ×‘×“×¨×š ××œ×™×” ××• ×‘×—×–×¨×” ××× ×”?)",
      hint: "",
      type: "single",
      key: "q1_whenContext",
      options: [
        { label: "×›×Ÿ", value: "yes" },
        { label: "×œ×", value: "no" },
        { label: "×× ×™ ×œ× ×‘×˜×•×—/×”", value: "unsure" }
      ],
      validate: (v) => !!v
    },
    {
      id: "q2",
      title: "××ª×™ ×‘×¢×¨×š ×§×¨×ª×” ×”×¤×’×™×¢×”?",
      hint: "",
      type: "single",
      key: "q2_whenTime",
      options: [
        { label: "×××© ×¢×›×©×™×• (×‘Ö¾7 ×”×™××™× ×”××—×¨×•× ×™×)", value: 0 },
        { label: "×‘×—×•×“×©×™× ×”××—×¨×•× ×™×", value: 1 },
        { label: "×œ×¤× ×™ ×©× ×” ××• ×™×•×ª×¨", value: 2 },
        { label: "×œ×¤× ×™ ×™×•×ª×¨ ×Ö¾3 ×©× ×™×", value: 3 }
      ],
      validate: (v) => v !== null && v !== undefined
    },
    {
      id: "q3",
      title: "××™×š ×”×¤×’×™×¢×” ×”×©×¤×™×¢×” ×¢×œ×™×š ×××– ×”××™×¨×•×¢?",
      hint: "",
      type: "single",
      key: "q3_impact",
      options: [
        { label: "×”×¤×’×™×¢×” ×“×¨×©×” × ×™×ª×•×— ××• ×ª×§×•×¤×ª ×©×™×§×•× ××¨×•×›×”", value: 0 },
        { label: "× ×–×§×§×ª×™ ×œ×˜×™×¤×•×œ ×¨×¤×•××™ ××©××¢×•×ª×™ (××™×•×Ÿ / ××©×¤×•×– / ×‘×“×™×§×•×ª)", value: 1 },
        { label: "×§×™×‘×œ×ª×™ ×™××™ ××—×œ×” ×•×œ× ×—×–×¨×ª×™ ××™×“ ×œ×¢×‘×•×“×”", value: 2 },
        { label: "×—×–×¨×ª×™ ×œ×¢×‘×•×“ ××‘×œ ×¢× ×›××‘×™× ××• ××’×‘×œ×•×ª", value: 3 },
        { label: "×–×• ×”×™×™×ª×” ×¤×’×™×¢×” ×§×œ×” ×•×—×–×¨×ª×™ ×œ×©×’×¨×” ××”×¨", value: 4 }
      ],
      validate: (v) => v !== null && v !== undefined
    },
    {
      id: "q4",
      title: "×”×× ×™×© ×ª×™×¢×•×“ ×›×œ×©×”×• ××”××™×¨×•×¢ ××• ××”×¤×’×™×¢×”?",
      hint: "××¤×©×¨ ×œ×‘×—×•×¨ ×™×•×ª×¨ ××ª×©×•×‘×” ××—×ª",
      type: "multi",
      key: "q4_docs",
      options: [
        { label: "×™×© ×ª×™×¢×•×“ ×¨×¤×•××™ (××™×•×Ÿ / ×¨×•×¤× / ×‘×“×™×§×•×ª)", value: "medical" },
        { label: "×“×™×•×•×—×ª×™ ×œ××¢×¡×™×§ ×¢×œ ×”×¤×’×™×¢×”", value: "employer" },
        { label: "×™×© ×¢×“×™× ××• ×ª×™×¢×•×“ × ×•×¡×£ (×ª××•× ×•×ª / ×“×•×´×—)", value: "evidence" },
        { label: "×¢×“×™×™×Ÿ ×œ×, ××‘×œ ×× ×™ ×™×›×•×œ/×” ×œ×”×©×™×’", value: "can_get" },
        { label: "×œ×, ××™×Ÿ ×œ×™ ×ª×™×¢×•×“ ×›×¨×’×¢", value: "none" }
      ],
      validate: (v) => Array.isArray(v) && v.length > 0
    },
    {
      id: "q5",
      title: "×”×× ×›×‘×¨ ×¤× ×™×ª ×œ×‘×™×˜×•×— ×”×œ××•××™ ××• ×”×ª×—×œ×ª ×”×œ×™×š ×›×œ×©×”×• ×‘×¢×§×‘×•×ª ×”×¤×’×™×¢×”?",
      hint: "",
      type: "single",
      key: "q5_process",
      options: [
        { label: "×œ×, ×¢×“×™×™×Ÿ ×œ×", value: 0 },
        { label: "×›×Ÿ, ×¤× ×™×ª×™ ××‘×œ ×× ×™ ×œ× ×‘×˜×•×—/×” ×©×¢×©×™×ª×™ ××ª ×–×” × ×›×•×Ÿ", value: 1 },
        { label: "×›×Ÿ, ×”×’×©×ª×™ ×ª×‘×™×¢×” ×œ×“××™ ×¤×’×™×¢×”", value: 2 },
        { label: "×›×Ÿ, ×× ×™ ×›×‘×¨ ×‘×ª×”×œ×™×š ××ª×§×“×", value: 3 },
        { label: "×× ×™ ×œ× ×‘×˜×•×—/×”", value: 4 }
      ],
      validate: (v) => v !== null && v !== undefined
    }
  ];

  function esc(str){ return String(str).replace(/</g,"&lt;").replace(/>/g,"&gt;"); }

  function showError(msg){
    errBox.style.display = "block";
    errBox.textContent = msg;
  }
  function clearError(){
    errBox.style.display = "none";
    errBox.textContent = "";
  }
  function showSubmitError(msg){
    submitErr.style.display = "block";
    submitErr.textContent = msg;
  }
  function clearSubmitError(){
    submitErr.style.display = "none";
    submitErr.textContent = "";
  }
  function showSubmitOk(msg){
    submitOk.style.display = "block";
    submitOk.textContent = msg;
  }
  function clearSubmitOk(){
    submitOk.style.display = "none";
    submitOk.textContent = "";
  }

  function computeLeadGrade(ans){
    let score = 0;

    // Q2 time
    if (ans.q2_whenTime === 0) score += 3;
    else if (ans.q2_whenTime === 1) score += 2;
    else if (ans.q2_whenTime === 2) score += 1;
    else if (ans.q2_whenTime === 3) score -= 2;

    // Q3 impact
    if (ans.q3_impact === 0) score += 4;
    else if (ans.q3_impact === 1) score += 3;
    else if (ans.q3_impact === 2) score += 2;
    else if (ans.q3_impact === 3) score += 1;
    else if (ans.q3_impact === 4) score -= 3;

    // Q4 docs
    const docs = new Set(ans.q4_docs || []);
    if (docs.has("medical")) score += 2;
    if (docs.has("employer")) score += 2;
    if (docs.has("evidence")) score += 1;
    if (docs.has("none")) score -= 2;

    // Q5 process
    if (ans.q5_process === 0) score += 2;
    if (ans.q5_process === 1) score += 3;
    if (ans.q5_process === 2) score += 1;
    if (ans.q5_process === 3) score -= 1;
    if (ans.q5_process === 4) score += 1;

    // Q1 context
    if (ans.q1_whenContext === "no") score -= 4;
    if (ans.q1_whenContext === "yes") score += 1;

    if (score >= 9) return { tag:"Gold", score, cls:"badgeGold" };
    if (score >= 6) return { tag:"High", score, cls:"badgeHigh" };
    if (score >= 3) return { tag:"Medium", score, cls:"badgeMed" };
    return { tag:"Low", score, cls:"badgeLow" };
  }

  function updateUIBadges(){
    const g = computeLeadGrade(state.answers);
    leadBadge.className = `badge ${g.cls}`;
    leadBadge.textContent = `××™×›×•×ª ×¤× ×™×™×”: ${g.tag}`;
  }

  function updateProgress(){
    const total = steps.length + 1; // + contact step
    const current = state.step + 1;
    progressTxt.textContent = `×©××œ×” ${current} ××ª×•×š ${total}`;
    const pct = Math.round((current / total) * 100);
    progressFill.style.width = pct + "%";
  }

  function renderStep(){
    clearError();
    updateUIBadges();
    updateProgress();

    const s = steps[state.step];
    qTitle.innerHTML = esc(s.title);
    qHint.textContent = s.hint || "";
    qForm.innerHTML = "";

    backBtn.disabled = state.step === 0;

    if (s.type === "single"){
      const current = state.answers[s.key];
      s.options.forEach((opt, idx) => {
        const id = `${s.id}_${idx}`;
        const wrapper = document.createElement("div");
        wrapper.className = "option";
        wrapper.innerHTML = `
          <input type="radio" name="${s.id}" id="${id}" ${current === opt.value ? "checked" : ""} />
          <label for="${id}">${esc(opt.label)}</label>
        `;
        wrapper.addEventListener("click", () => {
          state.answers[s.key] = opt.value;
          renderStep();
        });
        qForm.appendChild(wrapper);
      });
    }

    if (s.type === "multi"){
      const current = new Set(state.answers[s.key] || []);
      s.options.forEach((opt, idx) => {
        const id = `${s.id}_${idx}`;
        const wrapper = document.createElement("div");
        wrapper.className = "option";
        const checked = current.has(opt.value);

        wrapper.innerHTML = `
          <input type="checkbox" name="${s.id}" id="${id}" ${checked ? "checked" : ""} />
          <label for="${id}">${esc(opt.label)}</label>
        `;

        wrapper.addEventListener("click", () => {
          const now = new Set(state.answers[s.key] || []);
          if (now.has(opt.value)) now.delete(opt.value); else now.add(opt.value);

          // "none" is exclusive
          if (now.has("none") && now.size > 1) {
            now.clear(); now.add("none");
          }
          if (now.has("medical") || now.has("employer") || now.has("evidence") || now.has("can_get")) {
            if (now.has("none")) now.delete("none");
          }

          state.answers[s.key] = Array.from(now);
          renderStep();
        });

        qForm.appendChild(wrapper);
      });
    }
  }

  function showQuiz(){
    landingEl.classList.add("hidden");
    doneEl.classList.add("hidden");
    quizEl.classList.remove("hidden");
    renderStep();
  }

  function showDone(){
    quizEl.classList.add("hidden");
    doneEl.classList.remove("hidden");
  }

  startBtn.addEventListener("click", showQuiz);

  scrollMoreBtn.addEventListener("click", () => {
    moreArea.scrollIntoView({ behavior: "smooth", block: "start" });
  });

  backBtn.addEventListener("click", () => {
    if (state.step > 0) state.step--;
    renderStep();
  });

  nextBtn.addEventListener("click", () => {
    const s = steps[state.step];
    const v = state.answers[s.key];
    if (!s.validate(v)) return showError("×‘×‘×§×©×” ×œ×‘×—×•×¨ ×ª×©×•×‘×” ×›×“×™ ×œ×”××©×™×š.");

    if (state.step < steps.length - 1) {
      state.step++;
      renderStep();
    } else {
      showDone();
    }
  });

  restartBtn.addEventListener("click", () => {
    state.step = 0;
    state.answers = { q1_whenContext:null, q2_whenTime:null, q3_impact:null, q4_docs:[], q5_process:null };
    document.getElementById("fullName").value = "";
    document.getElementById("phone").value = "";
    document.getElementById("prefTime").value = "";
    clearSubmitError(); clearSubmitOk();

    doneEl.classList.add("hidden");
    quizEl.classList.add("hidden");
    landingEl.classList.remove("hidden");
  });

  submitBtn.addEventListener("click", async () => {
    clearSubmitError(); clearSubmitOk();

    const name = document.getElementById("fullName").value.trim();
    const phoneRaw = document.getElementById("phone").value.trim();
    const phone = phoneRaw.replace(/[-\s]/g,"");

    if (!name || name.length < 2) return showSubmitError("×‘×‘×§×©×” ×œ×”×–×™×Ÿ ×©× ××œ×.");
    if (!/^0\d{8,9}$/.test(phone)) return showSubmitError("×‘×‘×§×©×” ×œ×”×–×™×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×™×©×¨××œ×™ ×ª×§×™×Ÿ (×œ×“×•×’××” 05XXXXXXXX).");

    if (!WEBHOOK_URL || WEBHOOK_URL.includes("PASTE_YOUR_WEBHOOK_URL_HERE")) {
      return showSubmitError("×—×¡×¨×” ×›×ª×•×‘×ª ×©×œ×™×—×” (WEBHOOK_URL). ×”×“×‘×™×§×™ ××ª ×”-Webhook ×©×œ Make ×‘×§×•×“ ×•××– ×–×” ×™×¢×‘×•×“.");
    }

    const g = computeLeadGrade(state.answers);

    const payload = {
      createdAt: new Date().toISOString(),
      leadGrade: g.tag,
      leadScore: g.score,
      contact: {
        name,
        phone,
        preferredTime: document.getElementById("prefTime").value || null
      },
      answers: state.answers,
      meta: { source: "pitzuy_center_v2", locale: "he-IL" }
    };

    submitBtn.disabled = true;
    submitBtn.textContent = "×©×•×œ×—â€¦";

    try{
      const res = await fetch(WEBHOOK_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error("HTTP " + res.status);

      showSubmitOk("× ×©×œ×—! × ×—×–×•×¨ ××œ×™×™×š ×‘×”×§×“×.");
      submitBtn.textContent = "× ×©×œ×— âœ…";
    }catch(e){
      showSubmitError("××©×”×• ×œ× ×¢×‘×“ ×‘×©×œ×™×—×”. ×‘×“×§×™ ×©×”-Webhook × ×›×•×Ÿ ×•×©×”×ª×¨×—×™×© ×‘-Make ××—×›×” ×œ× ×ª×•× ×™×.");
      submitBtn.disabled = false;
      submitBtn.textContent = "×¨×•×¦×” ×©×™×—×–×¨×• ××œ×™×™ ×•×™×¢×©×• ×œ×™ ×¡×“×¨";
    }
  });
</script>
</body>
</html>
