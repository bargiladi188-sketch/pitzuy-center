<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×‘×“×™×§×” ×¨××©×•× ×™×ª ×œ×–×›×•×™×•×ª â€“ ×ª××•× ×ª ×¢×‘×•×“×”</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e6e9f2;
      --primary:#1e40af;
      --primary2:#2563eb;
      --accent:#06b6d4;
      --soft:#f1f5ff;
      --ok:#16a34a;
      --bad:#dc2626;

      --r:18px;
      --shadow: 0 16px 40px rgba(15,23,42,.08);
      --shadow2: 0 10px 22px rgba(15,23,42,.07);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
      background:
        radial-gradient(900px 520px at 85% 0%, rgba(37,99,235,.12), transparent 55%),
        radial-gradient(900px 520px at 15% 10%, rgba(6,182,212,.10), transparent 55%),
        linear-gradient(180deg, #ffffff, var(--bg));
      color: var(--text);
      line-height: 1.65;
    }

    .wrap{ max-width: 980px; margin: 0 auto; padding: 26px 16px 90px; }

    /* Top bar */
    .top{
      display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;
      margin-bottom: 14px;
    }
    .brand{ display:flex; align-items:center; gap:10px; font-weight: 900; letter-spacing:-.2px; }
    .mark{
      width:38px; height:38px; border-radius: 14px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      box-shadow: 0 14px 28px rgba(37,99,235,.18);
    }
    .chips{ display:flex; gap:10px; flex-wrap:wrap; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius: 999px;
      border: 1px solid rgba(203,213,225,.9);
      background: rgba(255,255,255,.75);
      color: var(--muted);
      font-size: 12px; font-weight: 800;
    }
    .dot{ width:8px; height:8px; border-radius: 99px; background: var(--ok); }

    /* Layout */
    .shell{
      border: 1px solid rgba(226,232,240,.9);
      background: rgba(255,255,255,.65);
      border-radius: 26px;
      padding: 16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 14px;
    }
    @media (max-width: 920px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 22px;
      box-shadow: var(--shadow2);
    }

    h1{
      margin: 0 0 10px;
      font-size: 34px;
      line-height: 1.18;
      letter-spacing: -.4px;
    }
    .lead{ margin: 0 0 14px; color: var(--muted); font-size: 16.5px; max-width: 62ch; }

    .ctaRow{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top: 14px; }
    .btn{
      border:0; cursor:pointer;
      border-radius: 16px;
      padding: 14px 18px;
      font-weight: 900;
      font-size: 16px;
      color: #fff;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      box-shadow: 0 16px 30px rgba(37,99,235,.18);
      transition: transform .15s ease, filter .15s ease;
      min-width: 240px;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.02); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }
    .btnGhost{
      border-radius: 16px;
      padding: 14px 18px;
      font-weight: 900;
      font-size: 16px;
      background: #fff;
      color: var(--text);
      border: 1px solid rgba(203,213,225,.9);
      cursor:pointer;
      min-width: 240px;
    }

    .mini{ margin-top: 12px; color: #64748b; font-size: 12px; }

    /* Trust cards */
    .trustGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 16px;
    }
    @media (max-width: 920px){ .trustGrid{ grid-template-columns:1fr; } }
    .trust{
      border: 1px solid rgba(226,232,240,.95);
      border-radius: 16px;
      background: linear-gradient(180deg, #ffffff, #fbfdff);
      padding: 12px;
    }
    .trust b{ display:block; margin-bottom: 4px; }
    .trust span{ color: var(--muted); font-size: 13px; }

    /* Side */
    .kicker{
      margin: 0 0 10px;
      font-size: 12px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #64748b;
      font-weight: 900;
    }
    .steps{ margin:0; padding:0; list-style:none; display:flex; flex-direction:column; gap:10px; }
    .step{
      display:flex; gap:10px; align-items:flex-start;
      border:1px solid rgba(226,232,240,.95);
      border-radius: 16px;
      padding: 12px;
      background: #fff;
    }
    .num{
      width:28px;height:28px;border-radius: 11px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(37,99,235,.10);
      color: var(--primary);
      font-weight: 900;
      flex: 0 0 auto;
    }
    .step p{ margin:0; color: var(--muted); font-size: 13px; }

    .divider{ height:1px; background: rgba(226,232,240,.95); margin: 16px 0; }

    /* FAQ */
    details{
      border:1px solid rgba(226,232,240,.95);
      border-radius: 16px;
      background: #fff;
      padding: 12px 14px;
      margin: 10px 0;
    }
    summary{
      cursor:pointer;
      font-weight: 900;
      color: var(--text);
      list-style:none;
    }
    summary::-webkit-details-marker{ display:none; }
    details p{ margin: 8px 0 0; color: var(--muted); font-size: 13px; }

    /* QUIZ */
    .hidden{ display:none !important; }
    .quizTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(203,213,225,.9);
      background: rgba(241,245,255,.70);
      font-weight: 900;
      font-size: 12px;
      color: var(--text);
    }
    .progressText{ font-size: 12px; color: var(--muted); font-weight: 900; }
    .bar{
      height: 10px;
      background: rgba(226,232,240,.95);
      border-radius: 999px;
      overflow:hidden;
      margin: 10px 0 16px;
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transition: width .25s ease;
    }
    .qTitle{ margin:0 0 8px; font-size: 20px; letter-spacing: -.1px; }
    .hint{ margin:0 0 10px; color: var(--muted); font-size: 13px; font-weight: 800; }

    .option{
      display:flex;
      align-items:flex-start;
      gap: 12px;
      padding: 14px;
      margin: 10px 0;
      border-radius: 16px;
      border: 1px solid rgba(203,213,225,.95);
      background: #fff;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
    }
    .option:hover{
      transform: translateY(-1px);
      border-color: rgba(37,99,235,.35);
      background: #f8fbff;
    }
    .option input{ width:18px; height:18px; margin-top:2px; cursor:pointer; }
    .option label{ cursor:pointer; font-weight: 800; flex:1; }

    .actions{ display:flex; gap:12px; flex-wrap:wrap; margin-top: 12px; }
    .actions button{ flex: 1 1 200px; }

    .err,.ok{
      display:none;
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      font-weight: 900;
      font-size: 13px;
      border: 1px solid;
    }
    .err{ background:#fef2f2; border-color:#fecaca; color: var(--bad); }
    .ok{ background:#f0fdf4; border-color:#bbf7d0; color: var(--ok); }

    /* CONTACT */
    .field label{ display:block; font-weight: 900; margin: 10px 0 6px; }
    input[type="text"], input[type="tel"], select{
      width:100%;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(203,213,225,.95);
      background: #fff;
      font-size: 16px;
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    input:focus, select:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 0 0 4px rgba(37,99,235,.12);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand"><div class="mark"></div><div>×‘×“×™×§×” ×¨××©×•× ×™×ª ×œ×–×›×•×™×•×ª</div></div>
      <div class="chips">
        <span class="chip"><span class="dot"></span> ×œ×œ× ×”×ª×—×™×™×‘×•×ª</span>
        <span class="chip">ğŸ”’ ×“×™×¡×§×¨×˜×™</span>
        <span class="chip">â± ×‘×¢×¨×š 2 ×“×§×•×ª</span>
      </div>
    </div>

    <div class="shell">

      <!-- LANDING -->
      <div id="landing" class="grid">
        <div class="card">
          <h1>× ×¤×’×¢×ª ×‘×¢×‘×•×“×”? ×‘×•×/×™ × ×¢×©×” ×¡×“×¨ â€” ×‘×©×§×˜.</h1>
          <p class="lead">
            ×›××” ×©××œ×•×ª ×§×¦×¨×•×ª ×©×™×¢×–×¨×• ×œ×”×‘×™×Ÿ ×× ×™×© ×”×™×ª×›× ×•×ª ×œ×¤×™×¦×•×™ ×•××” ×›×“××™ ×œ×¢×©×•×ª ×¢×›×©×™×•.
            ×’× ×× ××ª/×” ×œ× ×‘×˜×•×—/×” ×©×–×” × ×—×©×‘ â€œ×ª××•× ×ª ×¢×‘×•×“×”â€.
          </p>

          <div class="ctaRow">
            <button class="btn" id="startBtn">×”×ª×—×œ/×™ ×‘×“×™×§×” ×§×¦×¨×”</button>
            <button class="btnGhost" id="toFaqBtn" type="button">×™×© ×œ×™ ×©××œ×•×ª</button>
          </div>

          <div class="trustGrid">
            <div class="trust"><b>×× ×•×©×™ ×•×œ× ××œ×—×™×¥</b><span>×œ× â€œ×˜×•×¤×¡â€. ×¨×§ ×©××œ×•×ª ×©××¡×“×¨×•×ª ××ª ×”×ª××•× ×”.</span></div>
            <div class="trust"><b>×‘×œ×™ ××—×•×™×‘×•×ª</b><span>××ª/×” ×‘×•×—×¨/×ª ×× ×œ×”×©××™×¨ ×¤×¨×˜×™× ×‘×¡×•×£.</span></div>
            <div class="trust"><b>×¦×¢×“ ×”×‘× ×‘×¨×•×¨</b><span>×× ×ª×¨×¦×™/×” â€” ×©×™×—×” ×§×¦×¨×” ×©××¡×‘×™×¨×” ××” ×¢×•×©×™×.</span></div>
          </div>

          <div class="divider"></div>

          <div id="faq">
            <div class="kicker">×©××œ×•×ª × ×¤×•×¦×•×ª</div>
            <details>
              <summary>×–×” â€œ×¨×©××™â€? ×–×” ××—×™×™×‘ ××•×ª×™?</summary>
              <p>×œ×. ×–×• ×‘×“×™×§×” ×¨××©×•× ×™×ª ×œ×”×›×•×•× ×” ×‘×œ×‘×“. ××™×Ÿ ×›××Ÿ ×”×ª×—×™×™×‘×•×ª, ×•××™×Ÿ ×—×•×‘×” ×œ×”×©××™×¨ ×¤×¨×˜×™×.</p>
            </details>
            <details>
              <summary>××” ×§×•×¨×” ××—×¨×™ ×©×× ×™ ××©××™×¨/×” ×¤×¨×˜×™×?</summary>
              <p>×”×¤×¨×˜×™× × ×©×œ×—×™× ×œ××¢×¨×›×ª ×©×œ×š (Make), ×›×“×™ ×©×’×•×¨× ×× ×•×¡×” ×™×—×–×•×¨ ×œ×¤×•× ×” ×•×™×¡×‘×™×¨ ××ª ×”××¤×©×¨×•×™×•×ª ×•×”×¦×¢×“×™× ×”×‘××™×.</p>
            </details>
            <details>
              <summary>×œ××” ××ª× ×©×•××œ×™× ×¢×œ ×ª×™×¢×•×“?</summary>
              <p>×›×™ ×ª×™×¢×•×“ ×¨×¤×•××™/×“×™×•×•×— ×œ××¢×¡×™×§ ×¢×•×–×¨×™× ×œ×”×‘×™×Ÿ ××”×¨ ×™×•×ª×¨ ×× ×™×© ×‘×¡×™×¡ â€” ×•×—×•×¡×›×™× ×–××Ÿ ×œ×›×•×œ×.</p>
            </details>
          </div>

          <div class="mini">*×”××™×“×¢ × ×•×¢×“ ×œ×”×›×•×•× ×” ×¨××©×•× ×™×ª ×‘×œ×‘×“ ×•××™× ×• ×™×™×¢×•×¥ ××©×¤×˜×™.</div>
        </div>

        <div class="card">
          <div class="kicker">××™×š ×–×” ×¢×•×‘×“</div>
          <ul class="steps">
            <li class="step"><div class="num">1</div><p>×××œ××™× 5 ×©××œ×•×ª ×§×¦×¨×•×ª.</p></li>
            <li class="step"><div class="num">2</div><p>××¡×›××™× â€œ×ª××•× ×” ×¨××©×•× ×™×ªâ€: ×˜×¨×™×•×ª + ×”×©×¤×¢×” + ×ª×™×¢×•×“.</p></li>
            <li class="step"><div class="num">3</div><p>×‘×¡×•×£ â€” ××™ ×©×¨×•×¦×”, ××©××™×¨ ×¤×¨×˜×™× ×œ×©×™×—×” ×¨×’×•×¢×” ×•×‘×¨×•×¨×”.</p></li>
          </ul>

          <div class="divider"></div>

          <div class="kicker">××©×¤×˜ ×§×˜×Ÿ ×©××¨×’×™×¢</div>
          <p style="margin:0;color:var(--muted);font-size:13px;">
            ×”×¨×‘×” ×× ×©×™× ×œ× ×¤×•× ×™× ×›×™ ×”× â€œ×œ× ×‘×˜×•×—×™×â€. ×”×‘×“×™×§×” ×”×–×• × ×•×¢×“×” ×‘×“×™×•×§ ×œ×–×”.
          </p>
        </div>
      </div>

      <!-- QUIZ -->
      <div id="quiz" class="card hidden">
        <div class="quizTop">
          <span id="leadBadge" class="badge">××™×›×•×ª ×¤× ×™×™×”: â€”</span>
          <span id="progressTxt" class="progressText">×©××œ×” 1 ××ª×•×š 6</span>
        </div>
        <div class="bar"><div id="progressFill" class="fill"></div></div>

        <h2 id="qTitle" class="qTitle"></h2>
        <div id="qHint" class="hint"></div>
        <form id="qForm"></form>

        <div class="actions">
          <button class="btnGhost" id="backBtn" type="button">××—×•×¨×”</button>
          <button class="btn" id="nextBtn" type="button">×”××©×š</button>
        </div>

        <div id="errBox" class="err"></div>
      </div>

      <!-- CONTACT -->
      <div id="done" class="card hidden">
        <h2 style="margin:0 0 8px;font-size:22px;">×¡×™×™×× ×• âœ…</h2>
        <p class="lead" style="margin:0 0 10px;">
          ×× ×ª×¨×¦×™/×” â€” ××¤×©×¨ ×œ×”×©××™×¨ ×¤×¨×˜×™× ×œ×©×™×—×” ×§×¦×¨×” ×©×¢×•×©×” ×¡×“×¨ ×‘×–×›×•×™×•×ª ×•×‘×¦×¢×“×™× ×”×‘××™×. ×‘×œ×™ ×”×ª×—×™×™×‘×•×ª.
        </p>

        <div class="divider"></div>

        <div class="field">
          <label for="fullName">×©× ××œ×</label>
          <input type="text" id="fullName" placeholder="×œ×“×•×’××”: ×‘×¨ ×›×”×Ÿ" />
        </div>

        <div class="field">
          <label for="phone">×˜×œ×¤×•×Ÿ</label>
          <input type="tel" id="phone" placeholder="05X-XXXXXXX" />
        </div>

        <div class="field">
          <label for="prefTime">××ª×™ ×”×›×™ × ×•×— ×œ×“×‘×¨? (××•×¤×¦×™×•× ×œ×™)</label>
          <select id="prefTime">
            <option value="">×œ×‘×—×™×¨×”</option>
            <option>×‘×•×§×¨</option>
            <option>×¦×”×¨×™×™×</option>
            <option>××—×¨ ×”×¦×”×¨×™×™×</option>
            <option>×¢×¨×‘</option>
          </select>
        </div>

        <p class="mini">×‘×œ×—×™×¦×” ×¢×œ ×”×›×¤×ª×•×¨, ×”×¤×¨×˜×™× ×•×”×‘×“×™×§×” ×™×™×©×œ×—×• ×œÖ¾Make Webhook ×©×œ×š.</p>

        <button class="btn" id="submitBtn">×¨×•×¦×” ×©×™×—×–×¨×• ××œ×™×™ ×•×™×¢×©×• ×œ×™ ×¡×“×¨</button>
        <div id="submitErr" class="err"></div>
        <div id="submitOk" class="ok"></div>

        <div class="divider"></div>
        <button class="btnGhost" id="restartBtn" type="button">××™×œ×•×™ ××—×“×©</button>
      </div>

    </div>
  </div>

<script>
  // ×”×“×‘×™×§×™ ×›××Ÿ ××ª ×”-Webhook ×©×œ Make
  const WEBHOOK_URL = "PASTE_YOUR_WEBHOOK_URL_HERE";

  const landingEl = document.getElementById("landing");
  const quizEl = document.getElementById("quiz");
  const doneEl = document.getElementById("done");

  const startBtn = document.getElementById("startBtn");
  const toFaqBtn = document.getElementById("toFaqBtn");

  const backBtn = document.getElementById("backBtn");
  const nextBtn = document.getElementById("nextBtn");

  const qTitle = document.getElementById("qTitle");
  const qHint  = document.getElementById("qHint");
  const qForm  = document.getElementById("qForm");

  const errBox = document.getElementById("errBox");
  const progressTxt = document.getElementById("progressTxt");
  const progressFill = document.getElementById("progressFill");
  const leadBadge = document.getElementById("leadBadge");

  const submitBtn = document.getElementById("submitBtn");
  const restartBtn = document.getElementById("restartBtn");
  const submitErr = document.getElementById("submitErr");
  const submitOk  = document.getElementById("submitOk");

  const state = {
    step: 0,
    answers: {
      q1_whenContext: null,
      q2_whenTime: null,
      q3_impact: null,
      q4_docs: [],
      q5_process: null
    }
  };

  const steps = [
    {
      id: "q1",
      title: "××ª×™ ×–×” ×§×¨×”? (×‘×–××Ÿ ×”×¢×‘×•×“×” / ×‘×“×¨×š ××œ×™×” / ×‘×—×–×¨×” ××× ×”)",
      hint: "×× ××ª/×” ×œ× ×‘×˜×•×—/×” â€” ×–×” ×‘×¡×“×¨.",
      type: "single",
      key: "q1_whenContext",
      options: [
        { label: "×›×Ÿ", value: "yes" },
        { label: "×œ×", value: "no" },
        { label: "×× ×™ ×œ× ×‘×˜×•×—/×”", value: "unsure" }
      ],
      validate: (v) => !!v
    },
    {
      id: "q2",
      title: "××ª×™ ×‘×¢×¨×š ×§×¨×ª×” ×”×¤×’×™×¢×”?",
      hint: "",
      type: "single",
      key: "q2_whenTime",
      options: [
        { label: "×××© ×¢×›×©×™×• (×‘Ö¾7 ×”×™××™× ×”××—×¨×•× ×™×)", value: 0 },
        { label: "×‘×—×•×“×©×™× ×”××—×¨×•× ×™×", value: 1 },
        { label: "×œ×¤× ×™ ×©× ×” ××• ×™×•×ª×¨", value: 2 },
        { label: "×œ×¤× ×™ ×™×•×ª×¨ ×Ö¾3 ×©× ×™×", value: 3 }
      ],
      validate: (v) => v !== null && v !== undefined
    },
    {
      id: "q3",
      title: "××™×š ×–×” ×”×©×¤×™×¢ ×¢×œ×™×š ×××–?",
      hint: "×‘×—×¨/×™ ××ª ××” ×©×”×›×™ ×§×¨×•×‘ ×œ××¦×‘ ×©×œ×š.",
      type: "single",
      key: "q3_impact",
      options: [
        { label: "×”×™×” × ×™×ª×•×— / ×©×™×§×•× ××¨×•×š", value: 0 },
        { label: "×˜×™×¤×•×œ ××©××¢×•×ª×™ (××™×•×Ÿ / ××©×¤×•×– / ×‘×“×™×§×•×ª)", value: 1 },
        { label: "×™××™ ××—×œ×” ×•×œ× ×—×–×¨×ª×™ ××™×“", value: 2 },
        { label: "×—×–×¨×ª×™ ××‘×œ ×¢× ×›××‘×™×/××’×‘×œ×•×ª", value: 3 },
        { label: "×¤×’×™×¢×” ×§×œ×” ×•×—×–×¨×ª×™ ××”×¨ ×œ×©×’×¨×”", value: 4 }
      ],
      validate: (v) => v !== null && v !== undefined
    },
    {
      id: "q4",
      title: "×™×© ×œ×š ××™×–×©×”×• ×ª×™×¢×•×“?",
      hint: "××¤×©×¨ ×œ×‘×—×•×¨ ×™×•×ª×¨ ××ª×©×•×‘×” ××—×ª",
      type: "multi",
      key: "q4_docs",
      options: [
        { label: "×ª×™×¢×•×“ ×¨×¤×•××™ (××™×•×Ÿ / ×¨×•×¤× / ×‘×“×™×§×•×ª)", value: "medical" },
        { label: "×“×™×•×•×—×ª×™ ×œ××¢×¡×™×§", value: "employer" },
        { label: "×™×© ×¢×“×™×/×ª××•× ×•×ª/×“×•×´×—", value: "evidence" },
        { label: "×¢×“×™×™×Ÿ ×œ×, ××‘×œ ××¤×©×¨ ×œ×”×©×™×’", value: "can_get" },
        { label: "××™×Ÿ ×ª×™×¢×•×“ ×›×¨×’×¢", value: "none" }
      ],
      validate: (v) => Array.isArray(v) && v.length > 0
    },
    {
      id: "q5",
      title: "×”×× ×›×‘×¨ ×¤× ×™×ª ×œ×‘×™×˜×•×— ×”×œ××•××™/×”×ª×—×œ×ª ××©×”×•?",
      hint: "",
      type: "single",
      key: "q5_process",
      options: [
        { label: "×œ×, ×¢×“×™×™×Ÿ ×œ×", value: 0 },
        { label: "×›×Ÿ, ×¤× ×™×ª×™ ××‘×œ ×œ× ×‘×˜×•×—/×” ×©×¢×©×™×ª×™ × ×›×•×Ÿ", value: 1 },
        { label: "×›×Ÿ, ×”×’×©×ª×™ ×“××™ ×¤×’×™×¢×”", value: 2 },
        { label: "×›×Ÿ, ×× ×™ ×›×‘×¨ ×‘×ª×”×œ×™×š ××ª×§×“×", value: 3 },
        { label: "×× ×™ ×œ× ×‘×˜×•×—/×”", value: 4 }
      ],
      validate: (v) => v !== null && v !== undefined
    }
  ];

  function esc(str){ return String(str).replace(/</g,"&lt;").replace(/>/g,"&gt;"); }
  function showError(msg){ errBox.style.display="block"; errBox.textContent=msg; }
  function clearError(){ errBox.style.display="none"; errBox.textContent=""; }
  function showSubmitError(msg){ submitErr.style.display="block"; submitErr.textContent=msg; }
  function clearSubmitError(){ submitErr.style.display="none"; submitErr.textContent=""; }
  function showSubmitOk(msg){ submitOk.style.display="block"; submitOk.textContent=msg; }
  function clearSubmitOk(){ submitOk.style.display="none"; submitOk.textContent=""; }

  function computeLeadGrade(ans){
    let score = 0;

    if (ans.q2_whenTime === 0) score += 3;
    else if (ans.q2_whenTime === 1) score += 2;
    else if (ans.q2_whenTime === 2) score += 1;
    else if (ans.q2_whenTime === 3) score -= 2;

    if (ans.q3_impact === 0) score += 4;
    else if (ans.q3_impact === 1) score += 3;
    else if (ans.q3_impact === 2) score += 2;
    else if (ans.q3_impact === 3) score += 1;
    else if (ans.q3_impact === 4) score -= 3;

    const docs = new Set(ans.q4_docs || []);
    if (docs.has("medical")) score += 2;
    if (docs.has("employer")) score += 2;
    if (docs.has("evidence")) score += 1;
    if (docs.has("none")) score -= 2;

    if (ans.q5_process === 0) score += 2;
    if (ans.q5_process === 1) score += 3;
    if (ans.q5_process === 2) score += 1;
    if (ans.q5_process === 3) score -= 1;
    if (ans.q5_process === 4) score += 1;

    if (ans.q1_whenContext === "no") score -= 4;
    if (ans.q1_whenContext === "yes") score += 1;

    if (score >= 9) return { tag:"Gold", score };
    if (score >= 6) return { tag:"High", score };
    if (score >= 3) return { tag:"Medium", score };
    return { tag:"Low", score };
  }

  function updateProgress(){
    const total = steps.length + 1; // + ×¤×¨×˜×™×
    const current = state.step + 1;
    progressTxt.textContent = `×©××œ×” ${current} ××ª×•×š ${total}`;
    progressFill.style.width = Math.round((current/total)*100) + "%";
  }

  function renderStep(){
    clearError();
    updateProgress();

    const s = steps[state.step];
    qTitle.innerHTML = esc(s.title);
    qHint.textContent = s.hint || "";
    qForm.innerHTML = "";

    backBtn.disabled = state.step === 0;

    if (s.type === "single"){
      const current = state.answers[s.key];
      s.options.forEach((opt, idx) => {
        const id = `${s.id}_${idx}`;
        const w = document.createElement("div");
        w.className = "option";
        w.innerHTML = `
          <input type="radio" name="${s.id}" id="${id}" ${current === opt.value ? "checked" : ""}/>
          <label for="${id}">${esc(opt.label)}</label>
        `;
        w.addEventListener("click", () => { state.answers[s.key] = opt.value; renderStep(); });
        qForm.appendChild(w);
      });
    }

    if (s.type === "multi"){
      const current = new Set(state.answers[s.key] || []);
      s.options.forEach((opt, idx) => {
        const id = `${s.id}_${idx}`;
        const w = document.createElement("div");
        w.className = "option";
        const checked = current.has(opt.value);
        w.innerHTML = `
          <input type="checkbox" name="${s.id}" id="${id}" ${checked ? "checked" : ""}/>
          <label for="${id}">${esc(opt.label)}</label>
        `;
        w.addEventListener("click", () => {
          const now = new Set(state.answers[s.key] || []);
          if (now.has(opt.value)) now.delete(opt.value); else now.add(opt.value);

          // "none" ×‘×œ×¢×“×™
          if (now.has("none") && now.size > 1) { now.clear(); now.add("none"); }
          if (now.has("medical") || now.has("employer") || now.has("evidence") || now.has("can_get")) {
            if (now.has("none")) now.delete("none");
          }

          state.answers[s.key] = Array.from(now);
          renderStep();
        });
        qForm.appendChild(w);
      });
    }

    const g = computeLeadGrade(state.answers);
    leadBadge.textContent = `××™×›×•×ª ×¤× ×™×™×”: ${g.tag}`;
  }

  function showQuiz(){
    landingEl.classList.add("hidden");
    doneEl.classList.add("hidden");
    quizEl.classList.remove("hidden");
    state.step = 0;
    renderStep();
    window.scrollTo({top:0, behavior:"smooth"});
  }
  function showDone(){
    quizEl.classList.add("hidden");
    doneEl.classList.remove("hidden");
    window.scrollTo({top:0, behavior:"smooth"});
  }

  startBtn.addEventListener("click", showQuiz);
  toFaqBtn.addEventListener("click", () => document.getElementById("faq").scrollIntoView({behavior:"smooth"}));

  backBtn.addEventListener("click", () => { if (state.step > 0) state.step--; renderStep(); });

  nextBtn.addEventListener("click", () => {
    const s = steps[state.step];
    const v = state.answers[s.key];
    if (!s.validate(v)) return showError("×‘×‘×§×©×” ×œ×‘×—×•×¨ ×ª×©×•×‘×” ×›×“×™ ×œ×”××©×™×š.");

    if (state.step < steps.length - 1) { state.step++; renderStep(); }
    else { showDone(); }
  });

  restartBtn.addEventListener("click", () => {
    state.step = 0;
    state.answers = { q1_whenContext:null, q2_whenTime:null, q3_impact:null, q4_docs:[], q5_process:null };
    document.getElementById("fullName").value = "";
    document.getElementById("phone").value = "";
    document.getElementById("prefTime").value = "";
    clearSubmitError(); clearSubmitOk();
    doneEl.classList.add("hidden");
    quizEl.classList.add("hidden");
    landingEl.classList.remove("hidden");
    window.scrollTo({top:0, behavior:"smooth"});
  });

  submitBtn.addEventListener("click", async () => {
    clearSubmitError(); clearSubmitOk();

    const name = document.getElementById("fullName").value.trim();
    const phoneRaw = document.getElementById("phone").value.trim();
    const phone = phoneRaw.replace(/[-\s]/g,"");

    if (!name || name.length < 2) return showSubmitError("×‘×‘×§×©×” ×œ×”×–×™×Ÿ ×©× ××œ×.");
    if (!/^0\d{8,9}$/.test(phone)) return showSubmitError("×‘×‘×§×©×” ×œ×”×–×™×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×™×©×¨××œ×™ ×ª×§×™×Ÿ (×œ×“×•×’××” 05XXXXXXXX).");
    if (!WEBHOOK_URL || WEBHOOK_URL.includes("PASTE_YOUR_WEBHOOK_URL_HERE")) {
      return showSubmitError("×—×¡×¨×” ×›×ª×•×‘×ª ×©×œ×™×—×” (WEBHOOK_URL). ×”×“×‘×™×§×™ ××ª ×”-Webhook ×©×œ Make ×‘×§×•×“.");
    }

    const g = computeLeadGrade(state.answers);

    const payload = {
      createdAt: new Date().toISOString(),
      leadGrade: g.tag,
      leadScore: g.score,
      contact: {
        name,
        phone,
        preferredTime: document.getElementById("prefTime").value || null
      },
      answers: state.answers,
      meta: { source: "pitzuy_center_human_v1", locale: "he-IL" }
    };

    submitBtn.disabled = true;
    submitBtn.textContent = "×©×•×œ×—â€¦";

    try{
      const res = await fetch(WEBHOOK_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error("HTTP " + res.status);

      showSubmitOk("× ×©×œ×— âœ… × ×—×–×•×¨ ×‘×”×§×“×.");
      submitBtn.textContent = "× ×©×œ×— âœ…";
    }catch(e){
      showSubmitError("×”×©×œ×™×—×” × ×›×©×œ×”. ×‘×“×§×™ ×©×”-Webhook × ×›×•×Ÿ ×•×©×”×ª×¨×—×™×© ×‘-Make ××—×›×” ×œ× ×ª×•× ×™×.");
      submitBtn.disabled = false;
      submitBtn.textContent = "×¨×•×¦×” ×©×™×—×–×¨×• ××œ×™×™ ×•×™×¢×©×• ×œ×™ ×¡×“×¨";
    }
  });
</script>
</body>
</html>
