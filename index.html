<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>בדיקת זכאות לפיצוי – תאונת עבודה</title>

  <style>
    :root {
      --bg:#f8fafc;
      --card:#ffffff;
      --primary:#1e40af;
      --secondary:#3b82f6;
      --text:#1e293b;
      --muted:#64748b;
      --line:#e2e8f0;
      --success:#16a34a;
      --danger:#dc2626;
      --soft:#eff6ff;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }
    .wrap{ max-width: 680px; margin: 0 auto; padding: 40px 18px 70px; }
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.06);
    }
    h1{ margin: 0 0 10px; font-size: 28px; font-weight: 800; color: var(--primary); }
    h2{ margin: 0 0 10px; font-size: 22px; font-weight: 800; color: var(--primary); }
    .sub{ margin: 0 0 18px; color: var(--muted); font-size: 16px; }
    .divider{ height:1px; background: var(--line); margin: 22px 0; }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 12px;
      background: var(--soft);
      color: var(--primary);
      border-radius: 999px;
      font-size: 12px;
      font-weight: 800;
      border: 1px solid #dbeafe;
    }

    .topbar{
      display:flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    .progressText{ font-size: 13px; color: var(--muted); font-weight: 600; }

    .progress-bar{
      height: 8px;
      background: var(--line);
      border-radius: 999px;
      overflow: hidden;
      margin: 12px 0 18px;
    }
    .progress-fill{
      height: 100%;
      width: 0%;
      background: var(--primary);
      transition: width .25s ease;
    }

    .btn{
      border:0;
      border-radius: 12px;
      padding: 14px 18px;
      background: var(--primary);
      color: #fff;
      font-weight: 800;
      cursor: pointer;
      width: 100%;
      font-size: 17px;
      transition: transform .15s ease, background .15s ease;
    }
    .btn:hover{ background: var(--secondary); transform: translateY(-1px); }
    .btn:disabled{ background: #94a3b8; cursor: not-allowed; transform:none; }

    .ghost{
      background: transparent;
      border: 2px solid var(--line);
      color: var(--text);
    }
    .row{
      display:flex;
      gap:12px;
      flex-wrap: wrap;
    }
    .row > *{ flex: 1 1 220px; }

    .qTitle{ font-size: 20px; font-weight: 800; margin: 0 0 12px; }
    .hint{ margin: 0 0 10px; color: var(--muted); font-size: 13px; font-weight: 600; }

    .option{
      display:flex;
      align-items:flex-start;
      gap:12px;
      padding: 14px;
      border: 2px solid var(--line);
      border-radius: 14px;
      margin: 10px 0;
      cursor: pointer;
      transition: all .15s ease;
      background: #fff;
    }
    .option:hover{ border-color: var(--secondary); background: #f0f7ff; }
    .option input{ width: 18px; height: 18px; margin-top: 2px; cursor: pointer; }
    .option label{ cursor: pointer; font-weight: 650; flex: 1; }

    .small{ font-size: 12px; color: var(--muted); }
    .err{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #fecaca;
      background: #fef2f2;
      color: var(--danger);
      font-weight: 700;
      display:none;
    }
    .ok{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #bbf7d0;
      background: #f0fdf4;
      color: var(--success);
      font-weight: 800;
      display:none;
    }

    input[type="text"], input[type="tel"], select{
      width:100%;
      padding: 14px;
      border-radius: 12px;
      border: 2px solid var(--line);
      font-size: 16px;
      outline: none;
    }
    input[type="text"]:focus, input[type="tel"]:focus, select:focus{
      border-color: #93c5fd;
      box-shadow: 0 0 0 4px rgba(59,130,246,.12);
    }

    ul{ margin: 10px 0 0; padding: 0 18px 0 0; color: var(--muted); }
    li{ margin: 6px 0; }

    .footerNote{
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
    }

    .badgeGold{ background:#fff7ed; border-color:#fed7aa; color:#9a3412; }
    .badgeHigh{ background:#f0f9ff; border-color:#bae6fd; color:#075985; }
    .badgeMed{ background:#f5f3ff; border-color:#ddd6fe; color:#5b21b6; }
    .badgeLow{ background:#f8fafc; border-color:#e2e8f0; color:#334155; }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- LANDING -->
    <div class="card" id="landing">
      <h1>נפגעת בעבודה?</h1>
      <p class="sub">בדיקה קצרה שתעזור לך להבין אם מגיע לך פיצוי — ללא התחייבות.</p>

      <p class="sub">
        אם הפגיעה קרתה בזמן העבודה, בדרך אליה או ממנה — יכול להיות שמגיעות לך זכויות וכסף, גם אם את/ה לא בטוח/ה.
      </p>

      <ul>
        <li>הבדיקה לוקחת בערך 2 דקות</li>
        <li>דיסקרטי ולא מחייב</li>
        <li>מטרת הבדיקה: לעשות סדר לפני שמחליטים מה הצעד הבא</li>
      </ul>

      <div class="divider"></div>
      <button class="btn" id="startBtn">התחל/י בדיקה קצרה</button>

      <p class="footerNote">
        *המידע נועד לסייע בסדר ובהכוונה ראשונית בלבד, ואינו ייעוץ משפטי.
      </p>
    </div>

    <!-- QUIZ -->
    <div class="card" id="quiz" style="display:none;">
      <div class="topbar">
        <span class="tag" id="leadTag">בדיקה</span>
        <span class="progressText" id="progressTxt">שאלה 1 מתוך 6</span>
      </div>

      <div class="progress-bar" aria-label="התקדמות">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <h2 class="qTitle" id="qTitle"></h2>
      <div class="hint" id="qHint"></div>

      <form id="qForm"></form>

      <div class="divider"></div>

      <div class="row">
        <button class="btn ghost" id="backBtn" type="button">אחורה</button>
        <button class="btn" id="nextBtn" type="button">המשך</button>
      </div>

      <div class="err" id="errBox"></div>
    </div>

    <!-- DONE / CONTACT -->
    <div class="card" id="done" style="display:none;">
      <h2>סיימנו ✅</h2>
      <p class="sub">
        עברנו יחד על כמה שאלות כדי להבין את המצב שלך.
        אם תרצי/ה, גורם מנוסה בתחום תאונות עבודה יוכל לחזור אלייך, להסביר מה הזכויות ומה הצעד הבא — בלי התחייבות.
      </p>

      <div class="divider"></div>

      <div class="row">
        <div>
          <label for="fullName">שם מלא</label>
          <input type="text" id="fullName" placeholder="לדוגמה: בר כהן" />
        </div>
        <div>
          <label for="phone">טלפון</label>
          <input type="tel" id="phone" placeholder="05X-XXXXXXX" />
        </div>
        <div>
          <label for="prefTime">מתי הכי נוח לדבר? (אופציונלי)</label>
          <select id="prefTime">
            <option value="">לבחירה</option>
            <option>בוקר</option>
            <option>צהריים</option>
            <option>אחר הצהריים</option>
            <option>ערב</option>
          </select>
        </div>
      </div>

      <p class="small">
        בלחיצה על הכפתור, הפרטים והבדיקה יישלחו למערכת שלך (Make Webhook).
      </p>

      <button class="btn" id="submitBtn">רוצה שיחזרו אליי ויעשו לי סדר</button>
      <div class="err" id="submitErr"></div>
      <div class="ok" id="submitOk"></div>

      <div class="divider"></div>
      <button class="btn ghost" id="restartBtn" type="button">מילוי מחדש</button>
    </div>

  </div>

<script>
  // =========================
  // 1) כאן מדביקים את ה-Webhook של Make
  // =========================
  const WEBHOOK_URL = "PASTE_YOUR_WEBHOOK_URL_HERE";

  // =========================
  // State
  // =========================
  const state = {
    step: 0,
    answers: {
      q1_whenContext: null,
      q2_whenTime: null,
      q3_impact: null,
      q4_docs: [],
      q5_process: null
    }
  };

  const steps = [
    {
      id: "q1",
      title: "מתי זה קרה? (האם הפגיעה התרחשה בזמן העבודה, בדרך אליה או בחזרה ממנה?)",
      hint: "",
      type: "single",
      key: "q1_whenContext",
      options: [
        { label: "כן", value: "yes" },
        { label: "לא", value: "no" },
        { label: "אני לא בטוח/ה", value: "unsure" }
      ],
      validate: (v) => !!v
    },
    {
      id: "q2",
      title: "מתי בערך קרתה הפגיעה?",
      hint: "",
      type: "single",
      key: "q2_whenTime",
      options: [
        { label: "ממש עכשיו (ב־7 הימים האחרונים)", value: 0 },
        { label: "בחודשים האחרונים", value: 1 },
        { label: "לפני שנה או יותר", value: 2 },
        { label: "לפני יותר מ־3 שנים", value: 3 }
      ],
      validate: (v) => v !== null && v !== undefined
    },
    {
      id: "q3",
      title: "איך הפגיעה השפיעה עליך מאז האירוע?",
      hint: "",
      type: "single",
      key: "q3_impact",
      options: [
        { label: "הפגיעה דרשה ניתוח או תקופת שיקום ארוכה", value: 0 },
        { label: "נזקקתי לטיפול רפואי משמעותי (מיון / אשפוז / בדיקות)", value: 1 },
        { label: "קיבלתי ימי מחלה ולא חזרתי מיד לעבודה", value: 2 },
        { label: "חזרתי לעבוד אבל עם כאבים או מגבלות", value: 3 },
        { label: "זו הייתה פגיעה קלה וחזרתי לשגרה מהר", value: 4 }
      ],
      validate: (v) => v !== null && v !== undefined
    },
    {
      id: "q4",
      title: "האם יש תיעוד כלשהו מהאירוע או מהפגיעה?",
      hint: "אפשר לבחור יותר מתשובה אחת",
      type: "multi",
      key: "q4_docs",
      options: [
        { label: "יש תיעוד רפואי (מיון / רופא / בדיקות)", value: "medical" },
        { label: "דיווחתי למעסיק על הפגיעה", value: "employer" },
        { label: "יש עדים או תיעוד נוסף (תמונות / דו״ח)", value: "evidence" },
        { label: "עדיין לא, אבל אני יכול/ה להשיג", value: "can_get" },
        { label: "לא, אין לי תיעוד כרגע", value: "none" }
      ],
      validate: (v) => Array.isArray(v) && v.length > 0
    },
    {
      id: "q5",
      title: "האם כבר פנית לביטוח הלאומי או התחלת הליך כלשהו בעקבות הפגיעה?",
      hint: "",
      type: "single",
      key: "q5_process",
      options: [
        { label: "לא, עדיין לא", value: 0 },
        { label: "כן, פניתי אבל אני לא בטוח/ה שעשיתי את זה נכון", value: 1 },
        { label: "כן, הגשתי תביעה לדמי פגיעה", value: 2 },
        { label: "כן, אני כבר בתהליך מתקדם", value: 3 },
        { label: "אני לא בטוח/ה", value: 4 }
      ],
      validate: (v) => v !== null && v !== undefined
    }
  ];

  // =========================
  // DOM
  // =========================
  const landing = document.getElementById("landing");
  const quiz = document.getElementById("quiz");
  const done = document.getElementById("done");

  const startBtn = document.getElementById("startBtn");
  const backBtn = document.getElementById("backBtn");
  const nextBtn = document.getElementById("nextBtn");

  const qTitle = document.getElementById("qTitle");
  const qHint = document.getElementById("qHint");
  const qForm = document.getElementById("qForm");
  const errBox = document.getElementById("errBox");

  const progressTxt = document.getElementById("progressTxt");
  const progressFill = document.getElementById("progressFill");

  const leadTag = document.getElementById("leadTag");

  const submitBtn = document.getElementById("submitBtn");
  const restartBtn = document.getElementById("restartBtn");
  const submitErr = document.getElementById("submitErr");
  const submitOk = document.getElementById("submitOk");

  // =========================
  // Helpers
  // =========================
  function showError(msg){
    errBox.style.display = "block";
    errBox.textContent = msg;
  }
  function clearError(){
    errBox.style.display = "none";
    errBox.textContent = "";
  }
  function showSubmitError(msg){
    submitErr.style.display = "block";
    submitErr.textContent = msg;
  }
  function clearSubmitError(){
    submitErr.style.display = "none";
    submitErr.textContent = "";
  }
  function showSubmitOk(msg){
    submitOk.style.display = "block";
    submitOk.textContent = msg;
  }
  function clearSubmitOk(){
    submitOk.style.display = "none";
    submitOk.textContent = "";
  }
  function esc(str){
    return String(str).replace(/</g,"&lt;").replace(/>/g,"&gt;");
  }

  function computeLeadGrade(ans){
    let score = 0;

    // Q2 time
    if (ans.q2_whenTime === 0) score += 3;
    else if (ans.q2_whenTime === 1) score += 2;
    else if (ans.q2_whenTime === 2) score += 1;
    else if (ans.q2_whenTime === 3) score -= 2;

    // Q3 impact
    if (ans.q3_impact === 0) score += 4;
    else if (ans.q3_impact === 1) score += 3;
    else if (ans.q3_impact === 2) score += 2;
    else if (ans.q3_impact === 3) score += 1;
    else if (ans.q3_impact === 4) score -= 3;

    // Q4 docs
    const docs = new Set(ans.q4_docs || []);
    if (docs.has("medical")) score += 2;
    if (docs.has("employer")) score += 2;
    if (docs.has("evidence")) score += 1;
    if (docs.has("none")) score -= 2;

    // Q5 process
    if (ans.q5_process === 0) score += 2;
    if (ans.q5_process === 1) score += 3;
    if (ans.q5_process === 2) score += 1;
    if (ans.q5_process === 3) score -= 1;
    if (ans.q5_process === 4) score += 1;

    // Q1 context
    if (ans.q1_whenContext === "no") score -= 4;
    if (ans.q1_whenContext === "yes") score += 1;

    if (score >= 9) return { tag: "Gold Lead", score, cls: "badgeGold" };
    if (score >= 6) return { tag: "High", score, cls: "badgeHigh" };
    if (score >= 3) return { tag: "Medium", score, cls: "badgeMed" };
    return { tag: "Low", score, cls: "badgeLow" };
  }

  function updateProgress(){
    // steps.length = 5 (Q1..Q5). contact step is separate.
    const total = steps.length + 1; // includes contact
    const current = state.step + 1; // quiz step number
    progressTxt.textContent = `שאלה ${current} מתוך ${total}`;
    const pct = Math.round((current / total) * 100);
    progressFill.style.width = pct + "%";
  }

  function renderStep(){
    clearError();
    const s = steps[state.step];
    qTitle.innerHTML = esc(s.title);
    qHint.textContent = s.hint || "";
    qForm.innerHTML = "";

    // Back button
    backBtn.disabled = state.step === 0;

    // Update lead tag (live)
    const grade = computeLeadGrade(state.answers);
    leadTag.textContent = `${grade.tag} • ${grade.score}`;
    leadTag.className = `tag ${grade.cls}`;

    updateProgress();

    if (s.type === "single"){
      const current = state.answers[s.key];
      s.options.forEach((opt, idx) => {
        const id = `${s.id}_${idx}`;
        const wrapper = document.createElement("div");
        wrapper.className = "option";
        wrapper.innerHTML = `
          <input type="radio" name="${s.id}" id="${id}" ${current === opt.value ? "checked" : ""} />
          <label for="${id}">${esc(opt.label)}</label>
        `;
        wrapper.addEventListener("click", () => {
          state.answers[s.key] = opt.value;
          renderStep();
        });
        qForm.appendChild(wrapper);
      });
    }

    if (s.type === "multi"){
      const current = new Set(state.answers[s.key] || []);
      s.options.forEach((opt, idx) => {
        const id = `${s.id}_${idx}`;
        const wrapper = document.createElement("div");
        wrapper.className = "option";
        const checked = current.has(opt.value);

        wrapper.innerHTML = `
          <input type="checkbox" name="${s.id}" id="${id}" ${checked ? "checked" : ""} />
          <label for="${id}">${esc(opt.label)}</label>
        `;
        wrapper.addEventListener("click", () => {
          const now = new Set(state.answers[s.key] || []);
          if (now.has(opt.value)) now.delete(opt.value); else now.add(opt.value);

          // UX rule: "none" exclusive
          if (now.has("none") && now.size > 1) {
            now.clear(); now.add("none");
          }
          if (now.has("medical") || now.has("employer") || now.has("evidence") || now.has("can_get")) {
            if (now.has("none")) now.delete("none");
          }

          state.answers[s.key] = Array.from(now);
          renderStep();
        });
        qForm.appendChild(wrapper);
      });
    }
  }

  function goToQuiz(){
    landing.style.display = "none";
    done.style.display = "none";
    quiz.style.display = "block";
    renderStep();
  }

  function goToDone(){
    quiz.style.display = "none";
    done.style.display = "block";
    // show final progress full
    progressFill.style.width = "100%";
  }

  function validateCurrent(){
    const s = steps[state.step];
    const val = state.answers[s.key];
    if (!s.validate(val)) return "בבקשה לבחור תשובה כדי להמשיך.";
    return null;
  }

  // =========================
  // Events
  // =========================
  startBtn.addEventListener("click", goToQuiz);

  backBtn.addEventListener("click", () => {
    if (state.step > 0) state.step--;
    renderStep();
  });

  nextBtn.addEventListener("click", () => {
    const err = validateCurrent();
    if (err) return showError(err);

    if (state.step < steps.length - 1) {
      state.step++;
      renderStep();
    } else {
      goToDone();
    }
  });

  restartBtn.addEventListener("click", () => {
    state.step = 0;
    state.answers = { q1_whenContext:null, q2_whenTime:null, q3_impact:null, q4_docs:[], q5_process:null };
    document.getElementById("fullName").value = "";
    document.getElementById("phone").value = "";
    document.getElementById("prefTime").value = "";
    clearSubmitError(); clearSubmitOk();
    landing.style.display = "block";
    quiz.style.display = "none";
    done.style.display = "none";
  });

  submitBtn.addEventListener("click", async () => {
    clearSubmitError(); clearSubmitOk();

    const name = document.getElementById("fullName").value.trim();
    const phoneRaw = document.getElementById("phone").value.trim();
    const phone = phoneRaw.replace(/[-\s]/g,"");

    if (!name || name.length < 2) return showSubmitError("בבקשה להזין שם מלא.");
    if (!/^0\d{8,9}$/.test(phone)) return showSubmitError("בבקשה להזין מספר טלפון ישראלי תקין (לדוגמה 05XXXXXXXX).");

    const grade = computeLeadGrade(state.answers);

    const payload = {
      createdAt: new Date().toISOString(),
      leadGrade: grade.tag,
      leadScore: grade.score,
      contact: {
        name,
        phone,
        preferredTime: document.getElementById("prefTime").value || null
      },
      answers: state.answers,
      meta: {
        source: "work_injury_landing",
        locale: "he-IL"
      }
    };

    if (!WEBHOOK_URL || WEBHOOK_URL.includes("PASTE_YOUR_WEBHOOK_URL_HERE")) {
      return showSubmitError("חסרה כתובת שליחה (WEBHOOK_URL). הדביקי את ה-Webhook של Make בקוד ואז זה יעבוד.");
    }

    submitBtn.disabled = true;
    submitBtn.textContent = "שולח…";

    try {
      const res = await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error("HTTP " + res.status);

      showSubmitOk("נשלח! נחזור אלייך בהקדם.");
      submitBtn.textContent = "נשלח ✅";
    } catch (e) {
      showSubmitError("משהו לא עבד בשליחה. בדקי שה-Webhook נכון ושהתרחיש ב-Make מחכה לנתונים.");
      submitBtn.disabled = false;
      submitBtn.textContent = "רוצה שיחזרו אליי ויעשו לי סדר";
    }
  });
</script>

</body>
</html>
